# Browser

## API

### IntersectionObserver
Используется для скролл анимаций, инфинити скролла или слежением за какими то объектом во время скролла.

```js
const elements = document.querySelectorAll(".observable");
const observer = new IntersectionObserver((entries, observer) => {
    /**
     * your magic
     */
}, {
    root: document.body,
    threshold: 1,
    rootMargin: 1,
})

elements.forEach((el) => observer.observe(el));;
```

#### Config

> `threshold` - свойство, которое используется для определения того, какая часть элемента уже видна и позволяет вызвать действие наблюдателя.
> Значение между 0 и 1 и это эквивалентно 0%-100%. По умолчанию 0.

> `rootMargin` - тоже самое, что и css margin.

> `root` - используется для установки границы точки обзора в виде размера элемента. Это должен быть один из наблюдаемых элементов и может быть полезно для контейнеров с прокруткой.

#### Methods

`unobserve()` - Метод  используется, чтобы остановить IntersectionObserver от наблюдения за элементом, когда он уже наблюдался. Для ленивой загрузки изображений это может решить многие проблемы и ошибки.

`disconnect()` - похож на метод unobserve, но он полностью отключает все.

## Многопоточность в браузере

## Workers

> Worker — это полноценный системный поток, и в нем есть свой отдельный event loop, изолированный глобальный объект и другое.
> Ресурсные мощности worker-ов почти никак не связаны с ресурсами основного потока

### Типы

|                       | [Dedicated Worker](https://developer.mozilla.org/en-US/docs/Web/API/Worker) <br/> (Web Worker) | [Shared Worker](https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker)                                                                                                                                                                                                                   | [Service Worker](https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker)                                                                                                   |
|-----------------------|------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Popularity**        | High                                                                                           | Middle                                                                                                                                                                                                                                                                                           | High                                                                                                                                                                               |
| **Complexity**        | Low                                                                                            | Middle                                                                                                                                                                                                                                                                                           | Low                                                                                                                                                                                |
| **Common / personal** | Привязан к вкладке(для каждой вкладки создается свой).                                         | Привязан к домену, поэтому шарится между всеми вкладками.                                                                                                                                                                                                                                        | Привязан к домену, поэтому шарится между всеми вкладками.                                                                                                                          |
| **Support** (6.12.22) | [98.56%](https://caniuse.com/?search=web%20workers)                                            | [40.41%](https://caniuse.com/?search=Shared%20worker)                                                                                                                                                                                                                                            | [96.74%](https://caniuse.com/?search=service%20workers)                                                                                                                            |
| **Create**            | Создать каждой вкладкой индивидуально.                                                         | Создается в момент, когда любая первая вкладка попробует к нему подключиться.                                                                                                                                                                                                                    | Создается сразу.                                                                                                                                                                   |
| **Interaction**       | Коммуникация только со своей вкладкой.                                                         | Коммуникация с любой страницей домена. Может запоминать и отправлять сообщения как всем сразу, так и персонально.                                                                                                                                                                                | Коммуникация с любой страницей домена.                                                                                                                                             |
| **Close**             | Директивно, когда он будет не нужен или автоматически при закрытии вкладки.                    | Удаляется автоматически, после отключения от всех подписчиков.                                                                                                                                                                                                                                   | Живет бесконечно, даже когда нет ни одной открытой вкладки домена. Когда поток очень долго живет, браузеру оптимизирует, поэтому примерно раз в минуту пытается «усыпить» воркер.. |
| **Comment**           | Используется для оптимизации путем вынесения тяжелых вычислений в данный воркер.               | Можно использовать для общих вычислений                                                                                                                                                                                                                                                          | Основная возможность service worker — это перехватывать запросы к веб-ресурсам.                                                                                                    |
| **Example**           |                                                                                                | Как сделано в github: пользователи открывают больше, чем одну вкладку, а каждая вкладка — это новое вебсокет-подключение, что приводит к излишней нагрузке на бекендю, да и браузер пользователя тоже перерабатывает. В данном случае shared-worker помогает свести количество подключений до 1. | Можно построить кеширование и поддержку офлайн-режима в приложении, а так же реализовать поддержка пуш-уведомлений                                                                 |

### Минусы

Каждый поток обособленный и изолированный, поэтому:
- дополнительные расходы оперативной памяти
- нет шаринга между потоками данных
- почти все выполняется через копирование исключение([transferable objects](https://developer.mozilla.org/en-US/docs/Glossary/Transferable_objects))

### Links

- [Habr: Многопоточность на фронте: абсурд или прекрасное архитектурное решение?](https://habr.com/ru/post/701914/)
